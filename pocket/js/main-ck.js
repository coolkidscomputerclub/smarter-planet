var main={init:function(){console.log("Main initialised.");this.connectSocket()},connectSocket:function(){console.log("Socket connected.");this.socket=io.connect("//"+config.socketServer+":8080");this.bindSocketEvents()},bindSocketEvents:function(){function t(e){function a(e){String(e).length<2?e=String("0"+e):e=String(e);return e}var t=new Date(e),n=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),s=t.getHours(),o=t.getMinutes(),u=t.getSeconds(),f="";f+=n;f+=a(r);f+=a(i);f+=a(s);f+=a(o);f+=a(u);var l=moment(f,"YYYYMMDDhhmmss").fromNow();return l}console.log("Socket events bound.");var e=$("#events");this.socket.on("message",function(e){console.log("Message: ",e)});this.socket.on("users",function(e){console.log("Users",e);var t=$("#family-template").html(),n=Handlebars.compile(t);$("#user-select").html(n(e));window.userSelector=new Swipe(document.getElementById("user-select"),{startSlide:2,callback:function(){console.log(this.getPos())}})});this.socket.on("events",function(e){function i(e,t){return t.timestamp-e.timestamp}console.log("Events",e);var n=$("#timeline-history-template").html(),r=Handlebars.compile(n);console.log(e.events.sort(i));for(var s=0;s<e.events.length;s++)e.events[s].timeago=t(e.events[s].timestamp);$("#timeline ul").append(r(e))});this.socket.on("event",function(e){console.log("Single event",e);var n=$("#presence-event-template").html(),r=Handlebars.compile(n),i=$("#environment-event-template").html(),s=Handlebars.compile(i),o=$("#social-event-template").html(),u=Handlebars.compile(o),a=$("#timeline ul");e.timeago=t(e.timestamp);switch(e.type){case"presence":a.prepend(r(e));break;case"environment":a.prepend(s(e));break;case"social":a.prepend(u(e))}var f=$("."+e.user.id);f.hasClass("absent")?f.removeClass("absent").addClass("present"):f.hasClass("present")&&f.removeClass("present").addClass("absent")})}};$(function(){main.init()});